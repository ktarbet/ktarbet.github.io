<!DOCTYPE html>
<html lang="en">
<head>
    <title>Gradually Varied Flow </title>
    <link rel="stylesheet" href="gvf.css" type="text/css" />
    <script type="text/javascript" src="gvf.js"></script>
    
<script src="http://handsontable.com/lib/jquery.min.js"></script>
<script src="http://handsontable.com/dist/jquery.handsontable.full.js"></script>
<link rel="stylesheet" media="screen" href="http://handsontable.com/dist/jquery.handsontable.full.css">
<link rel="stylesheet" media="screen" href="http://handsontable.com/demo/css/samples.css">

</head>




<body>

    <h1>GVF</h1> Gradually Varied Open Channel Flow in Circular Sections.
    updated jan,15,2014 
    <p><input type="button" id="runForward" value="Run forward"   />
        
    </p>
    <table>
        <tr><td>Gravity:</td><td ><input size="10"  type="text" id="gravity" value="32.2"/></td>
            <td>Flow:</td><td><input size="10" type="text" id="flow" value="305.6"/></td>
            <td>Beginning Elevation:</td><td><input size="10" type="text" id="z1" value="660.1"/></td>
        </tr>
    </table>

    <div id="content"></div>
    <div class="handsontable" id="div1"></div>
    <div  id="divResults"></div>
    Notes:<br />
    <a href="http://handsontable.com/demo/numeric.html">http://handsontable.com/demo/numeric.html</a>
    <a href="http://oreilly.com/javascript/excerpts/javascript-good-parts/awful-parts.html"> awful-parts</a>

    <script type="text/javascript" >


        var data = [

["7.5", "7.5", "0.1", "0.024", "3.6", "0", "20", "10", "sect 1"],
["7.5", "7.5", "1E-5", "0.024", "0", "20", "25", "10", "sec 2"]
  ];
  
  $('#div1').handsontable({
    data: data,
    minSpareRows: 0,
    colHeaders: ["DIABEGIN", "DIAEND", "SLOPE", "N", "YBEGIN", "XBEGIN", "XEND", "STEPS", "COMMENT"],
    contextMenu: ['row_above', 'row_below', 'remove_row']
  });

  $('#runForward').on('click', function () {
      var tableData = $('#div1').handsontable('getData');
      var g = parseFloat($('#gravity').val());
      var q = parseFloat($('#flow').val());
      var z1 = parseFloat($('#z1').val());
      var tableOutput = [];
      var colNames = ["X", "Y", "y/D", "yn", "Beta", "Area", "E", "M", "V", "Fr", "Z", "H", "D", "y2", "abs(y2-y)", "yc"];
      var r = {};
      for (var rowIndex = 0; rowIndex < tableData.length; rowIndex++) {
          var diameter1 = parseFloat(tableData[rowIndex][0]);
          var diameter2 = parseFloat(tableData[rowIndex][1])
          var slope = parseFloat(tableData[rowIndex][2]);
          var n = parseFloat(tableData[rowIndex][3]);
          var y1 = parseFloat(tableData[rowIndex][4]);

          if (rowIndex != 0) {
              y1 = r.resultTable[r.resultTable.length - 1][1];
          }
          var x1 = parseFloat(tableData[rowIndex][5]);
          var x2 = parseFloat(tableData[rowIndex][6]);
          var steps = parseFloat(tableData[rowIndex][7]);
          var gvf = new CircularGVF(g, y1, x1, x2, n, slope, q, diameter1, diameter2, steps, z1, "sec1");
          r = gvf.solve();
          if (rowIndex === 0) {
              tableOutput = r.resultTable;
          }
          else {
              for (var i = 0; i < r.resultTable.length; i++) {
                  tableOutput.push(r.resultTable[i]);
              }
          }

      }

    $('#divResults').handsontable({
        data: tableOutput,
        minSpareRows: 0,
        columns: getColumnStyle(colNames),
        colHeaders: colNames,
        contextMenu: ['row_above', 'row_below', 'remove_row']
    });

});

function getColumnStyle(columnHeaders) {
    var rval = [];
    var i=0;
    for(i=0; i<columnHeaders.length; i++){
        rval.push({  type:'numeric', format: '0.00'});
            
    }
    return rval;
}

function convert2dArrayToCsv(arr) {
    return arr.reduce(function (csvString, row) {
        csvString += row.join(',');
        csvString += ';';
        return csvString;
    }, '');
}

   </script>
</body>
</html>